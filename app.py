import streamlit as st
from transformers import AutoTokenizer, AutoModelForSequenceClassification
import torch
import numpy as np

# Load model and tokenizer
@st.cache_resource
def load_model():
    model = AutoModelForSequenceClassification.from_pretrained("bert_bias_model")
    tokenizer = AutoTokenizer.from_pretrained("bert_bias_model")
    return tokenizer, model

tokenizer, model = load_model()
model.eval()

label_map = {
    0: -1,  # Left
    1: 0,   # Neutral
    2: 1    # Right
}

# Streamlit UI
st.title("üóûÔ∏è News Bias Detection")
st.write("Enter a news article snippet to detect its political bias.")

examples = {
    "Left": " Vice President Biden, center, leads the first meeting of the working group on gun violence on Dec. 20. From left, he‚Äôs joined by Attorney General Eric H. Holder Jr., National Association of Police Organizations President Thomas Nee, Philadelphia Police Commissioner Charles Ramsey, Homeland Security Secretary Janet Napolitano and other officials. (Chip Somodevilla/GETTY IMAGES) The White House is weighing a far broader and more comprehensive approach to curbing the nation‚Äôs gun violence than simply reinstating an expired ban on assault weapons and high-capacity ammunition, according to multiple people involved in the administration‚Äôs discussions. A working group led by Vice President Biden is seriously considering measures backed by key law enforcement leaders that would require universal background checks for firearm buyers, track the movement and sale of weapons through a national database, strengthen mental health checks, and stiffen penalties for carrying guns near schools or giving them to minors, the sources said. To sell such changes, the White House is developing strategies to work around the National Rifle Association that one source said could include rallying support from Wal-Mart and other gun retailers for measures that would benefit their businesses. White House aides have also been in regular contact with advisers to New York Mayor Michael R. Bloomberg (I), an outspoken gun-control advocate who could emerge as a powerful surrogate for the Obama administration‚Äôs agenda. The Biden group, formed last month after the massacre at a Newtown, Conn., elementary school that killed 20 children and six adults, plans to submit a package of recommendations to President Obama this month. Once Obama‚Äôs proposals are set, he plans to lead a public-relations offensive to generate popular support. ‚ÄúThey are very clearly committed to looking at this issue comprehensively,‚Äù said Dan Gross, president of the Brady Campaign to Prevent Gun Violence, who has been involved in the discussions. The proposals under consideration, he added, are ‚Äúa deeper exploration than just the assault-weapons ban.‚Äù Read the stories of the Newtown shooting victims The gun-control push is just one part of an ambitious political agenda that Obama has pledged to pursue after his decisive reelection victory in November, including comprehensive immigration reform, climate-change legislation and long-term deficit reduction. Obama also faces a reshuffling of his Cabinet, and a looming debate over the nation‚Äôs debt ceiling that will compete for his time and attention in the coming months. Seeking expansive mandate In addition to potential legislative proposals, Biden‚Äôs group has expanded its focus to include measures that would not need congressional approval and could be quickly implemented by executive action, according to interest-group leaders who have discussed options with Biden and key Cabinet secretaries. Possibilities include changes to federal mental-health programs and modernization of gun-tracking efforts by the Bureau of Alcohol, Tobacco, Firearms and Explosives. ‚ÄúSimply coming up with one or two aspects of it really falls short of the magnitude of the gun issue in the country,‚Äù said Chuck Wexler, executive director of the Police Executive Research Forum. Wexler was among a dozen law enforcement leaders who met with Biden and other administration leaders in the aftermath of the Dec. 14 massacre at Sandy Hook Elementary School in Newtown. The Dec. 20 summit, which stretched an hour beyond an allotted one hour, included Attorney General Eric H. Holder Jr., Education Secretary Arne Duncan, Homeland Security Secretary Janet Napolitano and Health and Human Services Secretary Kathleen Sebelius. Biden ‚Äúwanted to talk to us about the assault-weapons ban, automatic weapons, high-capacity magazines,‚Äù said Hennepin County (Minn.) Sheriff Richard Stanek, president of the Major County Sheriffs‚Äô Association. The vice president said the White House group would consider a variety of proposals ‚Äî from requiring background checks for all gun buyers to creating a new database that would allow the ATF to track all gun sales, according to participants. Stanek said the meeting also included significant discussion of mental-health issues, violence in video games and movies, and the poor quality of information contained in databases used to conduct criminal background checks before issuing gun permits. Some of the options the administration is considering may not ultimately be included in Obama‚Äôs package. A White House spokesman said Biden‚Äôs group was in the midst of its review and has made no decisions on its final recommendations. The White House is also developing strategies to navigate the rocky and emotionally fraught terrain of gun politics once final policy decisions are made. The administration is quietly talking with a diverse array of interest groups, including religious leaders, mental-health professionals and hunters, to build as broad a coalition as possible, those involved in the discussions said. The president is expected to face fierce opposition from the NRA and its allies in Congress, including most Republicans and some Democrats. But Biden signaled to those involved in the policy discussions that the White House is not afraid of taking on the NRA, the nation‚Äôs largest gun rights group. At the Dec. 20 meeting, according to Stanek, when one law enforcement leader suggested focusing on only the most popular proposals, Biden responded: ‚ÄúLook, what I‚Äôm asking you for is your candid opinion and ideas about extreme gun violence. Leave the politics to the president. That‚Äôs our job with Congress.‚Äù NRA officials declined a request for comment. In response to the shooting in Newtown, Wayne LaPierre, the group‚Äôs executive vice president, called for installing armed police officers in every school. ‚ÄúThe only thing that stops a bad guy with a gun is a good guy with a gun,‚Äù LaPierre said at a news conference Dec. 21. One potential strategy would be to win support for specific measures from interest groups that are normally aligned with the NRA, according to one person who works closely with the administration on gun-related issues and who spoke on the condition of anonymity because of the issue‚Äôs sensitivity. For instance, this person suggested, Wal-Mart and other major gun retailers may have an incentive to support closing a loophole that allows people to bypass background checks if they purchase firearms at gun shows or through other types of private sales. That could result in more people buying guns in retail stores. Timing is imperative Obama‚Äôs advisers have calculated that the longer they wait, the more distance there is from the Newtown massacre and the greater the risk that the bipartisan political will to tackle gun violence will dissipate. ‚ÄúThis is not something that I will be putting off,‚Äù Obama said on NBC‚Äôs ‚ÄúMeet the Press‚Äù in an interview broadcast last Sunday. At the White House meeting, Stanek said, ‚Äúthe vice president indicated that there was a very short timeline for him to get back to the president with his recommendations because the American public has a short memory.‚Äù Already, three weeks after the Newtown shooting, gun-control advocates are growing impatient with a legislative process that is just beginning. ‚ÄúAs we get involved in these ad nauseam debates over the Second Amendment, our children are still at risk,‚Äù said Jon Adler, national president of the Federal Law Enforcement Officers Association. ‚ÄúDebating is not the action verb we need to protect our children.‚Äù With the start of the 113th Congress last week, several lawmakers filed bills to address gun violence. Sen. Dianne Feinstein (D-Calif.), who co-wrote a 1994 assault-weapons ban that expired in 2004, plans to introduce legislation this month that would ban the sale or manufacture of about 120 firearms, including semiautomatic rifles and military-style handguns, as well as ammunition magazines that can hold more than 10 rounds. The expired federal assault-weapons ban prohibited the manufacturing of 19 models of semiautomatic guns classified as assault weapons, including certain rifles and shot guns. The law also banned ammunition magazines capable of holding more than 10 rounds. But it did not ban the sale of previously manufactured assault weapons or high-capacity magazines. Since the law‚Äôs sunset, efforts in Congress over the past decade to reinstate the ban have faced stiff opposition from the NRA and the firearms industry and have never passed. Adler, who has submitted recommendations to Biden‚Äôs group, said he has told administration officials that they need to pursue multiple measures to increase their chances of success. ‚ÄúWe can‚Äôt put all our protection-effort eggs in one basket with one piece of legislation,‚Äù he said. ‚ÄúWe‚Äôve got to do more than that.‚Äù",
    "Neutral": """WASHINGTON‚ÄîThe wrangling between the White House and Congress over a $1.1 trillion spending bill is the first test of how political forces unleashed by the midterm elections and impending 2016 campaigns will influence governing here.The fight foreshadows two years of legislative battles defined by tensions not just between the two parties‚Äîas has been the case since the Republican takeover of the House in 2010‚Äîbut within them. As Senate leaders attempted Friday to win support for quick passage of a House bill to fund most of the government through next September, they confronted the same resistance from conservative Republicans and liberal Democrats that nearly derailed the bill in the House. In the Senate, opposition could slow down the bill but isn‚Äôt expected to doom it.     Liberal Democrats say the party‚Äôs steep midterm election losses revealed a void in economic policy, which they are now moving forcefully to fill. This week, they rebelled against conservative provisions in the spending bill that President         Barack Obama    has been willing to accept.               Among Republicans, party leaders are contending with demands from the most conservative lawmakers to do more to scale back Mr. Obama‚Äôs health-care and immigration policies.        
Related Coverage        The open question is whether the newly energized ideological wings of each party will become an impediment to legislation‚Äîor whether they will be bypassed by lawmakers more open to compromise. That appeared to have happened Thursday, when 57 House Democrats joined 162 Republicans to form a fragile coalition to pass the spending bill.     For Mr. Obama, the new dynamic means he must contend not only with a more powerful Republican majority in Congress next year, but with an emboldened left wing of his own party if he tries to cut deals with Republicans and pursue an agenda at odds with that of his own supporters. He faces increasing resistance from progressive groups and liberal lawmakers in the mold of Sen. Elizabeth Warren (D., Mass.) and House Minority Leader Nancy Pelosi (D., Calif.), a White House ally whose vote against the budget agreement marked rare opposition to the president.     Those tensions are likely to come into play as Mr. Obama tries to advance portions of his agenda, such as trade deals, which could draw GOP support while losing liberal Democrats. Already, Ms. Warren and other liberal Democrats are moving to block Mr. Obama‚Äôs nomination of Lazard Ltd. banker         Antonio Weiss    to be an under secretary of the Treasury.     Mr. Obama on Friday had a sober message about the new political realities for his party, similar to one that House Speaker         John Boehner    (R., Ohio) has delivered to the right wing of his conference, which grew more forceful after the Republican takeover of the House in 2010.     ‚ÄúThis is what is produced when you have a divided government that the American people voted for,‚Äù the president said. ‚ÄúHad I been able to draft my own legislation, get it passed without any Republican votes, I suspect it would be slightly different. That is not the circumstance we find ourselves in.‚Äù     For Mr. Boehner and Sen. Mitch McConnell (R., Ky.), the next Senate majority leader, the challenge is to demonstrate that the new GOP majorities can net policy accomplishments with a Democratic White House while not overly frustrating conservatives‚Äô goals.     Mr. Boehner will have a larger majority when Congress is sworn in next year, but also a conservative bloc comfortable with using confrontation to reach its policy goals. Mr. McConnell has to contend with outspoken conservatives, such as Sens. Ted Cruz of Texas and         Rand Paul    of Kentucky, who likely will be positioning themselves for potential 2016 presidential bids.     Still, members of Congress who have lived through many lame-duck sessions‚Äîlike the one that produced the $1.1 trillion government-funding bill this week‚Äîsay that bill could be a model for how the parties move legislation in the next two years. They foresee legislation that falls in the sweet spot between Republicans‚Äô desire to prove they can govern and Mr. Obama‚Äôs interest in being productive in his final years in the White House.     ‚ÄúPresident Obama is going to have to get a few more points on the board for his legacy,‚Äù said Rep. Jack Kingston (R., Ga.), who lost his bid for the Senate and is leaving Congress at the end of this year. ‚ÄúThat could be the trans-Pacific partnership agreement; it could be a good resolution to the war with ISIS [Islamic State]. He is going to find pragmatic members of Congress who want to get things done.‚Äù              Trent Lott,    a Mississippi Republican who once served as Senate majority leader, said that the year-end drama could point to a path next year that finds more policy advanced from coalitions drawn from both parties, over the objections of liberal and conservative wings.     ‚ÄúI think we‚Äôre beginning to see some movement into next year that could be positive,‚Äù he said.     Some Democrats said Mr. Obama would likely work with Republicans even while drawing continued opposition from his own party. ‚ÄúI think you‚Äôre going to see him more engaged and probably more willing to compromise,‚Äù said former Senate Majority Leader Tom Daschle of South Dakota. ‚ÄúThis is probably the first illustration of that.‚Äù                                                 House Minority Leader Mitch McConnell and staff.          Associated Press                                                                                                             But others see next year‚Äôs Republican Congress passing legislation that would cross the bounds of what Mr. Obama could accept. ‚ÄúIt becomes harder to pass bills that can be signed,‚Äù said         Robert Greenstein,    president of left-leaning think tank Center on Budget and Policy Priorities. ‚ÄúThe main takeaway from this is that we‚Äôre going to have really big fights next year over policy riders and funding bills.‚Äù     The latest government-funding bill produced the unusual sight of Ms. Pelosi, the House Democratic leader, saying publicly that she was disappointed in the White House. She and other liberals, including Ms. Warren, criticized a provision that would loosen a requirement in the Dodd-Frank law that banks ‚Äúpush out‚Äù some of their riskiest derivatives-trading activities into affiliates ineligible for federal backstop programs, such as deposit insurance.     Banks argue that the requirement actually increases risk by moving swaps activity into less-regulated entities.     Some conservatives, including Mr. Cruz and Sen. Jeff Sessions (R., Ala.) wanted the bill to include language aimed at blocking Mr. Obama from an executive action to shield millions of immigrants from deportation.     The pressure within each party from its most ideological wings carries implications for the 2016 presidential race.     Liberals warned that they would continue to try to push the Democratic Party to the left. ‚ÄúMembers of Congress, candidates for Congress, candidates for president in 2016 need to recognize that the grass-roots base of this party is not on board with the Wall Street wing of this party,‚Äù said Charles Chamberlain, executive director of Democracy for America, the liberal group that is trying to draft Ms. Warren to enter the presidential race.     He called for a party that is ‚Äúmuch more aligned with the Warren wing‚Ä¶that fights against income inequality. That battle is going to be a pitched battle over the course of the next couple of years.‚Äù     This week‚Äôs spending debate was a reminder to GOP leaders that, even when they have a majority of the House and Senate next year, the president retains a central role in governing.     ‚ÄúWe can get a lot done, but we‚Äôre not going to be able to defeat the president,‚Äù said Rep. Tom Cole (R., Okla.), a close Boehner ally. ‚ÄúIf you want to pass legislation, you saw the coalition last night that could do that.‚Äù     Copyright ¬©2022 Dow Jones & Company, Inc. All Rights Reserved. 87990cbe856818d5eddac44c7b1cdeb8""",
    "Right": """The Washington Times - January 5, 2013, 11:40AM                                                               	A Marine‚Äôs defiant response to California Sen. Dianne Feinstein‚Äôs proposal to tighten gun control in the wake of the Newtown school shooting has gone viral on the Internet.                                                          An open letter from U.S. Marine Cpl. Joshua Brown, first posted on CNN last week, is trending on Facebook and Twitter and creating buzz on both left-leaning and conservative websites ‚Äî from the Huffington Post to The Blaze.                                                       SEE RELATED:                                                             The letter, titled ‚ÄúNo ma‚Äôam‚Äù is addressed directly to the California Democrat:                                                          
Senator Dianne Feinstein,
I will not register my weapons should this bill be passed, as I do not believe it is the government‚Äôs right to know what I own. Nor do I think it prudent to tell you what I own so that it may be taken from me by a group of people who enjoy armed protection yet decry me having the same a crime. You ma‚Äôam have overstepped a line that is not your domain. I am a Marine Corps veteran of 8 years, and I will not have some woman who proclaims the evil of an inanimate object, yet carries one, tell me I may not have one.
I am not your subject. I am the man who keeps you free. I am not your servant. I am the person whom you serve. I am not your peasant. I am the flesh and blood of America.
I am the man who fought for my country. I am the man who learned. I am an American. You will not tell me that I must register my semi-automatic AR-15 because of the actions of some evil man.
I will not be disarmed to suit the fear that has been established by the media and your misinformation campaign against the American public.
We, the people, deserve better than you.
Respectfully Submitted,Joshua Boston‚Ä®Cpl,United States Marine Corps2004-2012"""
}

# Initialize input state
if "input_text" not in st.session_state:
    st.session_state.input_text = ""

# Buttons to insert examples
st.markdown("#### üí° Try Examples:")
cols = st.columns(len(examples))
for i, (label, text) in enumerate(examples.items()):
    if cols[i].button(label):
        st.session_state.input_text = text

st.markdown("#### Or try your own news article:")
# Main text area
user_input = st.text_area("üìù Input Text", height=200, value=st.session_state.input_text, key="input_text")

# Prediction
if st.button("Analyze Bias"):
    if user_input.strip() == "":
        st.warning("Please enter some text.")
    else:
        inputs = tokenizer(user_input, return_tensors="pt", truncation=True, padding=True, max_length=512)
        with torch.no_grad():
            outputs = model(**inputs)
            probs = torch.softmax(outputs.logits, dim=1)
            pred = torch.argmax(probs, dim=1).item()
            confidence = probs[0][pred].item()

        bias_label = label_map[pred]
        label_name = { -1: "Left", 0: "Neutral", 1: "Right" }[bias_label]

        st.markdown(f"### üîç Prediction: **{label_name}**")
        st.markdown(f"Confidence: `{confidence:.2%}`")